# Migration `20201022105313`

This migration has been generated by ShashiSrinath at 10/22/2020, 4:23:13 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."GroupUserRole" AS ENUM ('admin', 'moderator', 'user')

CREATE TYPE "public"."PostVoteType" AS ENUM ('downvote', 'neutral', 'upvote')

CREATE TYPE "public"."UserRole" AS ENUM ('administrator', 'moderator', 'user')

CREATE TABLE "public"."Group" (
"id" SERIAL,
"name" text   NOT NULL ,
"description" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."GroupUser" (
"group_id" integer   NOT NULL ,
"user_id" integer   NOT NULL ,
"role" "GroupUserRole"  ,
PRIMARY KEY ("group_id","user_id")
)

CREATE TABLE "public"."Post" (
"id" SERIAL,
"group_id" integer   NOT NULL ,
"user_id" integer   NOT NULL ,
"title" text   NOT NULL ,
"content" text   NOT NULL ,
"media" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PostComment" (
"id" SERIAL,
"post_id" integer   NOT NULL ,
"user_id" integer   NOT NULL ,
"parent_comment_id" integer   NOT NULL ,
"content" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PostCommentVote" (
"comment_id" integer   NOT NULL ,
"user_id" integer   NOT NULL ,
"vote_type" "PostVoteType"  NOT NULL ,
"created_datetime" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("comment_id","user_id")
)

CREATE TABLE "public"."PostVote" (
"post_id" integer   NOT NULL ,
"user_id" integer   NOT NULL ,
"created_datetime" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"vote_type" "PostVoteType"  NOT NULL ,
PRIMARY KEY ("post_id","user_id")
)

CREATE TABLE "public"."User" (
"id" SERIAL,
"username" text   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"karma" integer   NOT NULL ,
"role" "UserRole"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Group.name_unique" ON "public"."Group"("name")

CREATE UNIQUE INDEX "Post.title_unique" ON "public"."Post"("title")

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

ALTER TABLE "public"."GroupUser" ADD FOREIGN KEY ("group_id")REFERENCES "public"."Group"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."GroupUser" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("group_id")REFERENCES "public"."Group"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostComment" ADD FOREIGN KEY ("parent_comment_id")REFERENCES "public"."PostComment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostComment" ADD FOREIGN KEY ("post_id")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostComment" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostCommentVote" ADD FOREIGN KEY ("comment_id")REFERENCES "public"."PostComment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostCommentVote" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostVote" ADD FOREIGN KEY ("post_id")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostVote" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201022105313
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,106 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Group{
+  id          Int          @id @default(autoincrement())
+  name        String       @unique
+  description String
+  users  GroupUser[]
+  posts        Post[]
+}
+
+model GroupUser {
+  groupId Int               @map("group_id")
+  userId  Int               @map("user_id")
+  role     GroupUserRole?
+  group   Group           @relation(fields: [groupId], references: [id])
+  user     User             @relation(fields: [userId], references: [id])
+
+  @@id([groupId, userId])
+}
+
+model Post{
+  id           Int            @id @default(autoincrement())
+  groupId     Int             @map("group_id")
+  userId      Int             @map("user_id")
+  title        String         @unique
+  content      String
+  media        String?
+  group       Group         @relation(fields: [groupId], references: [id])
+  user         User           @relation(fields: [userId], references: [id])
+  comments PostComment[]
+  votes    PostVote[]
+}
+
+model PostComment {
+  id                 Int                 @id @default(autoincrement())
+  postId            Int                  @map("post_id")
+  userId            Int                 @map("user_id")
+  parentCommentId  Int                 @map("parent_comment_id")
+  content            String
+  parentComment       PostComment        @relation("post_commentTopost_comment_parent_comment_id", fields: [parentCommentId], references: [id])
+  post              Post               @relation(fields: [postId], references: [id])
+  user               User                @relation(fields: [userId], references: [id])
+  childComments PostComment[]      @relation("post_commentTopost_comment_parent_comment_id")
+  votes  PostCommentVote[]
+}
+
+model PostCommentVote {
+  commentId       Int @map("comment_id")
+  userId          Int @map("user_id")
+  voteType        PostVoteType @map("vote_type")
+  createdDatetime DateTime @default(now()) @map("created_datetime")
+  comment     PostComment   @relation(fields: [commentId], references: [id])
+  user             User           @relation(fields: [userId], references: [id])
+
+  @@id([commentId, userId])
+}
+
+model PostVote {
+  postId          Int @map("post_id")
+  userId          Int        @map("user_id")
+  createdDatetime DateTime @default(now()) @map("created_datetime")
+  voteType        PostVoteType @map("vote_type")
+  post            Post          @relation(fields: [postId], references: [id])
+  user             User           @relation(fields: [userId], references: [id])
+
+  @@id([postId, userId])
+}
+
+model User {
+  id                Int                 @id @default(autoincrement())
+  username          String              @unique
+  email             String              @unique
+  password          String
+  karma             Int
+  role              UserRole
+  groupUsers        GroupUser[]
+  posts              Post[]
+  comments      PostComment[]
+  commentVotes PostCommentVote[]
+  postVotes         PostVote[]
+}
+
+enum GroupUserRole {
+  admin
+  moderator
+  user
+}
+
+enum PostVoteType {
+  downvote
+  neutral
+  upvote
+}
+
+enum UserRole {
+  administrator
+  moderator
+  user
+}
```


